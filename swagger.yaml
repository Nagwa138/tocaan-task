openapi: 3.0.0
info:
  title: Order Payment Management API
  description: RESTful API for managing orders and payments with extensible payment gateway system
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
servers:
  - url: http://localhost:8000/api
    description: Development server
  - url: https://api.example.com/v1
    description: Production server
tags:
  - name: Authentication
    description: User authentication and registration
  - name: Orders
    description: Order management endpoints
  - name: Payments
    description: Payment processing and management
paths:
  /register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
  /login:
    post:
      tags:
        - Authentication
      summary: Authenticate user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /logout:
    get:
      tags:
        - Authentication
      summary: Logout user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /orders:
    get:
      tags:
        - Orders
      summary: Get all orders
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, cancelled]
          description: Filter by order status
        - name: per_page
          in: query
          schema:
            type: integer
            default: 10
          description: Items per page
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
    post:
      tags:
        - Orders
      summary: Create a new order
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Order'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Get specific order
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Order'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags:
        - Orders
      summary: Update order
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderRequest'
      responses:
        '200':
          description: Order updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Order'
        '422':
          description: Validation error or business rule violation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - Orders
      summary: Delete order
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '422':
          description: Cannot delete order with payments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /orders/{id}/confirm:
    post:
      tags:
        - Orders
      summary: Confirm order
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order confirmed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '422':
          description: Only pending orders can be confirmed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /orders/{id}/cancel:
    post:
      tags:
        - Orders
      summary: Cancel order
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '422':
          description: Only pending orders can be cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /payments:
    get:
      tags:
        - Payments
      summary: Get all payments
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, successful, failed]
          description: Filter by payment status
        - name: order_id
          in: query
          schema:
            type: integer
          description: Filter by order ID
        - name: per_page
          in: query
          schema:
            type: integer
            default: 10
          description: Items per page
      responses:
        '200':
          description: List of payments
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payment'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
  /payments/gateways:
    get:
      tags:
        - Payments
      summary: Get available payment gateways
      security:
        - BearerAuth: []
      responses:
        '200':
          description: List of available gateways
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PaymentGateway'
  /orders/{id}/payments/process:
    post:
      tags:
        - Payments
      summary: Process payment for order
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProcessPaymentRequest'
      responses:
        '201':
          description: Payment processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
        '422':
          description: Validation error or business rule violation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many payment attempts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation successful
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Error description
        code:
          type: string
          example: ERROR_CODE
    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: The given data was invalid.
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
    PaginationMeta:
      type: object
      properties:
        current_page:
          type: integer
        from:
          type: integer
        last_page:
          type: integer
        links:
          type: array
          items:
            type: object
        path:
          type: string
        per_page:
          type: integer
        to:
          type: integer
        total:
          type: integer
    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
        - confirm_password
      properties:
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john@example.com
        password:
          type: string
          format: password
          minLength: 6
          example: password123
        confirm_password:
          type: string
          format: password
          example: password123
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: test@example.com
        password:
          type: string
          format: password
          example: password
    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: User signed in
        token:
          type: string
          example: 1|abcdefghijklmnopqrstuvwxyz123456
        name:
          type: string
          example: John Doe
    CreateOrderRequest:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - product
              - quantity
              - price
            properties:
              product:
                type: string
                maxLength: 255
                example: Laptop
              quantity:
                type: integer
                minimum: 1
                example: 1
              price:
                type: number
                format: float
                minimum: 0
                example: 999.99
        notes:
          type: string
          maxLength: 1000
          example: Please deliver before 5 PM
    UpdateOrderRequest:
      type: object
      properties:
        status:
          type: string
          enum: [pending, confirmed, cancelled]
          example: confirmed
        notes:
          type: string
          maxLength: 1000
        items:
          type: array
          items:
            type: object
            properties:
              product:
                type: string
              quantity:
                type: integer
              price:
                type: number
    Order:
      type: object
      properties:
        id:
          type: integer
          example: 1
        order_number:
          type: string
          example: ORD-20240101-001
        status:
          type: string
          enum: [pending, confirmed, cancelled, completed]
          example: confirmed
        total_amount:
          type: number
          format: float
          example: 199.99
        items:
          type: array
          items:
            type: object
            properties:
              product:
                type: string
              quantity:
                type: integer
              price:
                type: number
              total:
                type: number
        notes:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        user:
          $ref: '#/components/schemas/User'
        payments:
          type: array
          items:
            $ref: '#/components/schemas/Payment'
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
          format: email
    PaymentGateway:
      type: object
      properties:
        code:
          type: string
          example: credit_card
        name:
          type: string
          example: Credit/Debit Card
        description:
          type: string
          example: Pay using Visa, MasterCard, American Express
        supports_refund:
          type: boolean
          example: true
    ProcessPaymentRequest:
      type: object
      required:
        - method
        - gateway_data
      properties:
        method:
          type: string
          example: credit_card
          description: Payment gateway method
        gateway_data:
          type: object
          description: Gateway-specific payment data
          example:
            card_number: "4111111111111111"
            card_holder: "John Doe"
            expiry_month: 12
            expiry_year: 2025
            cvv: "123"
    Payment:
      type: object
      properties:
        id:
          type: integer
          example: 1
        payment_id:
          type: string
          example: txn_123456789
        order_id:
          type: integer
          example: 1
        status:
          type: string
          enum: [pending, successful, failed]
          example: successful
        method:
          type: string
          example: credit_card
        amount:
          type: number
          format: float
          example: 199.99
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        order:
          $ref: '#/components/schemas/Order'
        gateway_response:
          type: object
          nullable: true
    PaymentResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: '#/components/schemas/Payment'
        message:
          type: string
          example: Payment processed successfully
        code:
          type: string
          example: PAYMENT_SUCCESS
        gateway_reference:
          type: string
          nullable: true
          example: txn_123456789
        order_status:
          type: string
          example: completed
